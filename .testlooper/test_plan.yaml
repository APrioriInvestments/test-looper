
version: 1
environments:
    # linux docker container for running our pytest unit-tests
    linux-pytest:
        image:
            docker:
                dockerfile: .testlooper/environments/linux-pytest/Dockerfile
        variables:
            PYTHONPATH: ${REPO_ROOT}
            TP_COMPILER_CACHE: /tp_compiler_cache
            IS_TESTLOOPER: true
        min-ram-gb: 10
        custom-setup: |
            python -m pip install --editable .

    # native linux image necessary for running unit-tests that need to boot docker containers.
    linux-native:
        image:
            base_ami: ami-0XXXXXXXXXXXXXXXX  # ubuntu-20.04-ami
        min-ram-gb: 10
        custom-setup: |
            sudo apt-get --yes install python3.8-venv
            make install  # install pinned dependencies
builds:
    # skip

suites:
    pytest:
        kind: unit
        environment: linux-pytest
        dependencies:
        list-tests: |
            ./collect_pytest_tests.py -m 'not docker'
        run-tests: |
            ./run_pytest_tests.py -m 'not docker'
        timeout:

    pytest-docker:
        kind: unit
        environment: linux-native
        dependencies:
        list-tests: |
            ./collect_pytest_tests.py -m 'docker'
        run-tests: |
            ./run_pytest_tests.py  -m 'docker'
        timeout:

    matlab:
        kind: unit
        environment: linux-native
        dependencies:
        list-tests: |
            .testlooper/collect_matlab_tests.sh
        run-tests: |
            .testlooper/run_matlab_tests.sh
        timeout:
